(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const l of e)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(e){const l={};return e.integrity&&(l.integrity=e.integrity),e.referrerPolicy&&(l.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?l.credentials="include":e.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(e){if(e.ep)return;e.ep=!0;const l=r(e);fetch(e.href,l)}})();const B=await fetch("src/ui/mcq/template.html"),C=await B.text(),v=await fetch("src/ui/mcq/table.html"),T=await v.text(),F=await fetch("src/ui/mcq/cell.html"),$=await F.text();let a={};a.started=!1;a.render=function(t){t.innerHTML+=C,a.renderTable(t)};a.renderQuestion=function(t,i){if(!t)return;document.getElementById("current-question-index").textContent=i+1+"/"+a.flagList.length;const r=document.getElementById("question-image"),n=document.querySelectorAll(".answer-mcq-button ");r.src=t.url;let e=[t.name];for(;e.length<4;){let l=a.flagList[Math.floor(Math.random()*a.flagList.length)];e.includes(l.name)||e.push(l.name)}e=e.sort(()=>Math.random()-.5),n.forEach((l,o)=>{l.textContent=e[o],l.onclick=function(){n.forEach(c=>{c.textContent===t.name?(c.classList.add("bg-green-500"),c.classList.remove("hover:bg-blue-600"),c.classList.remove("bg-blue-500")):(c.classList.add("bg-red-500"),c.classList.remove("hover:bg-blue-600"),c.classList.remove("bg-blue-500"))}),l.textContent===t.name?a.renderCell(t,!0):a.renderCell(t,!1),setTimeout(()=>{n.forEach(c=>{c.classList.remove("bg-green-500","bg-red-500"),c.classList.add("hover:bg-blue-600"),c.classList.add("bg-blue-500")}),a.nextQuestion()},1e3)}})};a.start=function(t){document.getElementById("overlay-import").classList.add("hidden"),document.getElementById("quiz-container").classList.remove("blur-sm"),a.started=!0,a.flagList=t,a.currentQuestionIndex=0,a.renderQuestion(a.flagList[a.currentQuestionIndex],a.currentQuestionIndex)};a.nextQuestion=function(){a.currentQuestionIndex++,a.currentQuestionIndex<a.flagList.length?a.renderQuestion(a.flagList[a.currentQuestionIndex],a.currentQuestionIndex):alert("Quiz finished!")};a.renderTable=function(t){t.innerHTML+=T};a.clearTable=function(){document.getElementById("correct-answers").innerHTML="",document.getElementById("wrong-answers").innerHTML=""};a.renderCell=function(t,i){let r=$.replace("{{flagName}}",t.name).replace("{{path}}",t.url),n=document.getElementById(i?"correct-answers":"wrong-answers");n.innerHTML+=r};const q=await fetch("src/ui/gallery/cell.html"),j=await q.text(),k=await fetch("src/ui/gallery/gallery.html");await k.text();let g={};g.render=function(t,i){console.log("test"+i);let r=document.createElement("div");r.classList.add("gallery","flex","flex-row","flex-wrap","w-full"),i.forEach(n=>{let e=j.replace("{{flagName}}",n.name).replace("{{path}}",n.url);r.innerHTML+=e}),t.appendChild(r)};g.clear=function(t){t.innerHTML=""};let m={};m.getByPage=async function(t){let i=`https://commons.wikimedia.org/w/api.php?action=query&titles=${t}&generator=images&prop=imageinfo&iiprop=url&format=json&origin=*&gimlimit=500`,n=await(await fetch(i)).json();console.log(n);let e=[];for(let l in n.query.pages){let o=n.query.pages[l],c=o.title.replace(/^File:/,"").replace(/^Flag of /,"").replace(/\.svg$/,"").replace(/\.png$/,"").replace(/\.jpg$/,""),d=o.imageinfo[0].url;if(d.includes("System-search.svg"))continue;let u={name:c,url:d};e.push(u)}return e};m.getByCategory=async function(t){let i=`https://commons.wikimedia.org/w/api.php?action=query&titles=Category:${t}&generator=categorymembers&prop=imageinfo&iiprop=url&format=json&origin=*&gcmtype=file&gcmtitle=Category:${t}&gimlimit=150`,n=await(await fetch(i)).json();console.log(n);let e=[];for(let l in n.query.pages){let o=n.query.pages[l],c=o.title.replace(/^File:/,"").replace(/^Flag of /,"").replace(/\.svg$/,"").replace(/\.png$/,"").replace(/\.jpg$/,""),d=o.imageinfo[0].url;if(d.includes("System-search.svg"))continue;let u={name:c,url:d};e.push(u)}return e};m.getSections=async function(t){let i=`https://commons.wikimedia.org/w/api.php?action=parse&page=${t}&prop=sections&format=json&origin=*&gimlimit=150`,n=await(await fetch(i)).json();return console.log(n.parse.sections),n.parse.sections};m.getSortedBySection=async function(t){let i=`https://commons.wikimedia.org/w/api.php?action=parse&page=${t}&prop=sections|images&format=json&origin=*&gimlimit=150`,n=await(await fetch(i)).json();console.log(n);let e={};for(let l of n.parse.sections){let o=l.index,c=l.line,d=`https://commons.wikimedia.org/w/api.php?action=parse&page=${t}&section=${o}&prop=images&format=json&origin=*&gimlimit=150`,L=`https://commons.wikimedia.org/w/api.php?action=query&titles=${(await(await fetch(d)).json()).parse.images.map(f=>`File:${f}`).join("|")}&prop=imageinfo&iiprop=url&format=json&origin=*&gimlimit=150`,y=await(await fetch(L)).json(),w=[];for(let f in y.query.pages){let p=y.query.pages[f];if(!p.title||!p.imageinfo||!p.imageinfo[0].url)continue;let b=p.title.replace(/^File:/,"").replace(/^Flag of /,"").replace(/\.svg$/,"").replace(/\.png$/,"").replace(/\.jpg$/,"").replace(/\.jpeg$/,""),E=p.imageinfo[0].url;if(E.includes("System-search.svg"))continue;let I={name:b,url:E};w.push(I)}e[c]=w}return console.log(e),e};m.getPredifinedOptions=async function(){return await(await fetch("./src/data/json/predefined.json")).json()};const N=await fetch("src/ui/searchbar/searchbar.html"),S=await N.text();let s={};s.searchPage=async function(){let t=document.getElementById("wikimedia-link").value,i=new URL(t);s.pageName=i.pathname.split("/").pop(),console.log(s.pageName),a.started&&(g.clear(document.getElementById("gallery")),a.clearTable(document.getElementById("mcq"))),s.renderFilters(await m.getSections(s.pageName)),s.pageName.includes("Category:")?(s.pageName=s.pageName.replace("Category:",""),a.start(await m.getByCategory(s.pageName)),g.render(document.getElementById("gallery"),await m.getByCategory(s.pageName))):(a.start(await m.getByPage(s.pageName)),g.render(document.getElementById("gallery"),await m.getByPage(s.pageName)))};s.render=async function(t){let i=document.createElement("div");i.innerHTML=S,t.appendChild(i);let r=document.getElementById("predefined-lists-select");(await m.getPredifinedOptions()).forEach(e=>{let l=document.createElement("option");l.textContent=e.name,l.setAttribute("data-url","https://commons.wikimedia.org/wiki/"+e.value),r.appendChild(l)}),document.getElementById("submit-wikimedia-link").addEventListener("click",this.searchPage),document.getElementById("predefined-lists-select").addEventListener("change",this.setSearch)};s.setSearch=function(){let t=document.getElementById("predefined-lists-select"),r=t.options[t.selectedIndex].getAttribute("data-url"),n=document.getElementById("wikimedia-link");n.value=r};s.renderFilters=function(t){document.getElementById("filters-list").innerHTML="";let i=document.getElementById("filters-list");t.forEach(r=>{let n=document.createElement("div");n.classList.add("filter-sort");let e=document.createElement("label");e.classList.add("inline-flex","items-center");let l=document.createElement("input");l.type="checkbox",l.classList.add("form-checkbox"),l.onclick=function(){s.updateFilters()};let o=document.createElement("span");o.classList.add("ml-2"),o.textContent=r.line,e.appendChild(l),e.appendChild(o),n.appendChild(e),i.appendChild(n)})};s.updateFilters=async function(){document.getElementById("question-image").src="https://upload.wikimedia.org/wikipedia/commons/b/b1/Loading_icon.gif";let t=document.querySelectorAll(".filter-sort input"),i=Array.from(t).filter(e=>e.checked).map(e=>e.nextSibling.textContent),r=await m.getSortedBySection(s.pageName),n=[];i.forEach(e=>{r[e]&&(n=n.concat(r[e]))}),console.log("filtered flags",n),g.clear(document.getElementById("gallery")),a.clearTable(document.getElementById("mcq")),g.render(document.getElementById("gallery"),n),a.start(n)};const M=document.getElementById("MCQ"),Q=document.getElementById("nav");let x={};x.init=async function(){h.init()};let h={};h.init=async function(){s.render(Q),a.render(M)};h.renderHeader=function(){};x.init();
